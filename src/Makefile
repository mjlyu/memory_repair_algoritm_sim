
CXX=g++
CXXFLAGS=-Wall -std=c++11
OPTFLAGS=-O3

ifdef DEBUG
ifeq ($(DEBUG), 1)
OPTFLAGS = -O0 -g -DDEBUG
endif
endif
CXXFLAGS+=$(OPTFLAGS)

ALLSRC = $(wildcard *.c) $(wildcard *.cpp) 
MAIN = $(wildcard *Test.c) $(wildcard *Test.cpp) $(wildcard *Main.c) $(wildcard *Main.cpp)
MAIN_OBJS = $(addsuffix .o, $(basename $(MAIN)))  
EXES = $(basename $(MAIN))
SRCS = $(filter-out $(MAIN),$(ALLSRC))  
OBJS = $(addsuffix .o, $(basename $(SRCS)))  

REBUILDABLES = $(MAIN_OBJS) $(OBJS)

RepairRateMain: $(OBJS) RepairRateMain.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"
RunTimeMain: $(OBJS) RuntimeMain.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"
HeuristicMain: $(OBJS) HeuristicMain.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"
BasicTestMain: $(OBJS) BasicTestMain.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"
simpleTest: $(OBJS) simpleTest.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"

CombAndRepairMain: $(OBJS) CombAndRepairMain.o
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "---Built\033[32m $@ \033[0msuccessfully---"


#include the  autogenerated dependency file for each .o file
-include $(OBJS:.o=.dep)
-include $(MAIN_OBJ:.o=.dep)

# build dependency list via gCC -M and save to a .dep file
%.dep : %.cpp
	@$(CXX) -MM $(CXXFLAGS) $< > $@
%.dep : %.c
	@$(CXX) -MM $(CXXFLAGS) $< > $@

# build all .cpp and .c file to .o file
%.o : %.c  
	$(CXX) $(CXXFLAGS) -o $@  -c $< 
%.o : %.cpp  
	$(CXX) $(CXXFLAGS) -o $@  -c $< 


.PHONY:clean  
clean:  
	rm -f $(REBUILDABLES)  *.dep $(EXES)

disk-clean:
	rm -f $(REBUILDABLES)  *.dep results/*
	

echo:   
	@echo sources=$(SRC)  
	@echo objects=$(OBJ)  
	@echo dependence=*.dep 
	@echo CPPFLAGS=$(CXXFLAGS)  

